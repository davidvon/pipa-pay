webpackJsonp([5],{1:function(t,e){var a=t.exports={version:"2.4.0"};"number"==typeof __e&&(__e=a)},4:function(t,e,a){t.exports={"default":a(7),__esModule:!0}},6:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e["default"]={props:{type:{"default":"default"},disabled:{type:Boolean,"default":!1},mini:{type:Boolean,"default":!1},plain:{type:Boolean,"default":!1},text:String},computed:{classes:function(){return[{weui_btn_disabled:this.disabled,weui_btn_mini:this.mini},"weui_btn_"+this.type,this.plain?"weui_btn_plain_"+this.type:""]}}}},7:function(t,e,a){var d=a(1),s=d.JSON||(d.JSON={stringify:JSON.stringify});t.exports=function(t){return s.stringify.apply(s,arguments)}},10:function(t,e){t.exports=" <button class=weui_btn :class=classes :disabled=disabled> {{text}}<slot></slot> </button> "},11:function(t,e,a){var d,s;d=a(6),s=a(10),t.exports=d||{},t.exports.__esModule&&(t.exports=t.exports["default"]),s&&(("function"==typeof t.exports?t.exports.options||(t.exports.options={}):t.exports).template=s)},39:function(t,e,a){"use strict";function d(t){return t&&t.__esModule?t:{"default":t}}function s(t,e,a){u["default"].log("addCard","invoking wx:"+(0,r["default"])(t)),wx.addCard({cardList:t,success:function(t){u["default"].log("addCard","add card success:"+t+", json:"+(0,r["default"])(t.cardList)),e&&e(t.cardList)},cancel:function(t){a&&a()},fail:function(t){a&&a()}})}function i(t,e,a,d,i,n){t.$http.post(d+"weixin/card/add",{card_global_id:e,openid:a}).then(function(t){var a=t.data;if(0==a.result){var d=a.data,o=[];o.push({cardId:d.id,cardExt:'{"timestamp":"'+d.timestamp+'","signature":"'+d.signature+'"}'}),s(o,i,n)}else u["default"].log("wxAddCard","post add-card:"+e+" failed"),n&&n()},function(){u["default"].log("wxAddCard","post add-card:"+e+" exception"),n&&n()})}function n(t,e,a,d,i,n){t.$http.post(d+"weixin/cards/add",{orderId:e,openid:a}).then(function(t){var a=t.data;if(0==a.result){for(var d=a.data,o=[],c=0;c<d&&d.length;c++){var r=d[c];o.push({cardId:r.id,cardExt:'{"timestamp":"'+r.timestamp+'","signature":"'+r.signature+'"}'})}s(o,i,n)}else u["default"].log("wxAddCards","post add-cards order:"+e+" failed"),n&&n()},function(){u["default"].log("wxAddCards","post add-cards order:"+e+" exception"),n&&n()})}function o(t,e,a,d,s){u["default"].log("wxOpenCard","cardId:"+e+" code:"+a),wx.openCard({cardList:[{cardId:e,code:a}],success:function(t){var e=t.cardList;u["default"].log("wxOpenCard","card list:"+e),d&&d(e)},cancel:function(t){s&&s()},fail:function(t){s&&s()}})}Object.defineProperty(e,"__esModule",{value:!0});var c=a(4),r=d(c);e.wxAddCard=i,e.wxAddCards=n,e.wxOpenCard=o;var l=a(3),u=d(l)},107:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e["default"]={props:{show:{type:Boolean,required:!0,"default":!1,twoWay:!0},showCancel:{type:Boolean,"default":!1},cancelText:{type:String,"default":"取消"},menus:{type:Object,"default":{}}},methods:{emitEvent:function(t,e){"on-click-menu"!==t||/.noop/.test(e)||(this.$emit(t,e),this.$emit(t+"-"+e),this.show=!1)}}}},134:function(t,e,a){"use strict";function d(t){return t&&t.__esModule?t:{"default":t}}Object.defineProperty(e,"__esModule",{value:!0});var s=a(4),i=d(s),n=a(2),o=d(n),c=a(16),r=d(c),l=a(39),u=a(3),p=d(u);e["default"]={attached:function(){this.$root.navTitle="电子卡列表",this.$root.showHeader=!0},components:{Actionsheet:a(222),XButton:a(11)},data:function(){return{no_data:!1,cards:[],statusStr:["未入微信卡包","已入微信卡包,未激活","已激活","已过期","转赠中","已转赠"],statusClass:["wxcard-disable","wxcard-enable","wxcard-enable","wxcard-invalid","wxcard-disable","wxcard-invalid"]}},methods:{goHome:function(){this.$route.router.replace({name:"home"})},goBuy:function(){this.$route.router.go({name:"buy"})},chooseCard:function(){var t=this;location.href.split("#")[0];t.$http.post(o["default"].API_URL+"weixin/card/choose/sign").then(function(e){if(e&&e.data){var a=e.data;p["default"].log("cards","chooseCard:"+(0,i["default"])(a)),wx.chooseCard({timestamp:a.timestamp,nonceStr:a.nonceStr,signType:"SHA1",cardSign:a.cardSign,success:function(e){t.cards_online=e.cardList,t.cards_online||(t.cards_online=e.available_cards)}})}})},cardStatus:function(t){var e=["卡已购买,未放入微信卡包","卡已放入微信卡包,未激活","卡已放入微信卡包,已激活","卡已过期","卡在赠送状态中","卡已成功赠送"];return e[Number(t)]},openCard:function(t){var e=this;e.$dispatch("showLoading");var a=t.currentTarget.attributes,d=a["data-index"].value,s=a["data-globalid"].value,i=a["data-cardid"].value,n=a["data-status"].value;if(p["default"].log("cards","open card:"+s),n>=3)return e.$dispatch("hideLoading"),void e.$dispatch("alert",e.cardStatus(n));if(0==n)(0,l.wxAddCard)(e,s,e.openid,o["default"].API_URL,function(t){e.$http.post(o["default"].API_URL+"card/add/status/update",{openid:e.openid,cardGlobalId:s}).then(function(t){e.$dispatch("hideLoading"),0==t.result&&(e.cards[Number(d)].cardCode=t.data,e.cards[Number(d)].status=1,e.$dispatch("alert","该卡已加至微信卡包"))},function(){e.$dispatch("hideLoading"),e.$dispatch("alert","已加至微信卡包, 服务器更新异常")})},function(){e.$dispatch("hideLoading")});else{e.$dispatch("hideLoading");var c=a["data-cardcode"]&&a["data-cardcode"].value||0;(0,l.wxOpenCard)(e,i,c)}}},ready:function(){var t=this;t.openid=r["default"].wxOpenId,t.$dispatch("showLoading"),t.$http.post(o["default"].API_URL+"cards",{openid:t.openid}).then(function(e){t.$dispatch("hideLoading");var a=e.data;a&&0==a.result&&(t.cards=a.data),0==t.cards.length&&(t.no_data=!0)},function(){t.$dispatch("hideLoading")})}}},159:function(t,e,a){e=t.exports=a(14)(),e.push([t.id,".vux-actionsheet-gap{height:8px;width:100%;background-color:#eee}.vux-actionsheet-cancel:before{border-top:none}",""])},172:function(t,e,a){var d=a(159);"string"==typeof d&&(d=[[t.id,d,""]]);a(15)(d,{});d.locals&&(t.exports=d.locals)},186:function(t,e){t.exports=' <div> <div class=weui_mask_transition :class="{\'weui_fade_toggle\': show}" :style="{display: show ? \'block\' : \'none\'}" @click="show=false"></div> <div class=weui_actionsheet :class="{\'weui_actionsheet_toggle\': show}"> <div class=weui_actionsheet_menu> <div class=weui_actionsheet_cell v-for="(key, text) in menus" @click="emitEvent(\'on-click-menu\', key)" v-html=text> </div> <div class=vux-actionsheet-gap v-if=showCancel></div> <div class="weui_actionsheet_cell vux-actionsheet-cancel" @click="emitEvent(\'on-click-menu\', \'cancel\')" v-if=showCancel>{{cancelText}}</div> </div> </div> </div> '},214:function(t,e){t.exports=' <div class="memcards card"> <div class=content> <div class=weui_cells_title v-show=!no_data>你共有<span style=color:#e64340>{{cards.length}}</span>张礼品卡 </div> <div class=card_item data-index={{$index}} data-globalid={{item.globalId}} data-cardid={{item.cardId}} data-cardcode={{item.cardCode}} data-merchantid={{item.merchantId}} data-status={{item.status}} v-for="item in cards" @click=openCard> <div class=card_itop> <div class=card_it1><span class=card_img><img :src=item.logo alt=""></span></div> <div class=card_it3> <p class=gc_name>{{item.title}}</p> <p class=last_time>有效期至：{{item.expireDate}}</p> </div> </div> <div class=card_ibtm> <div class=card_ib1>余额: <span class=col4>￥<em>{{item.amount}}</em></span></div> <div class=card_ib2><span class={{statusClass[item.status]}}>{{statusStr[item.status]}}</span></div> </div> </div> <div class=not_card v-show=no_data> <p class=ncd_p1><span class=ico_nocard></span></p> <p class=ncd_p2>暂无可消费的电子卡</p> <p class=ncd_p3> <x-button type=primary @click=goBuy>购买电子卡</x-button> </p> </div> </div> </div> '},222:function(t,e,a){var d,s;a(172),d=a(107),s=a(186),t.exports=d||{},t.exports.__esModule&&(t.exports=t.exports["default"]),s&&(("function"==typeof t.exports?t.exports.options||(t.exports.options={}):t.exports).template=s)},249:function(t,e,a){var d,s;d=a(134),s=a(214),t.exports=d||{},t.exports.__esModule&&(t.exports=t.exports["default"]),s&&(("function"==typeof t.exports?t.exports.options||(t.exports.options={}):t.exports).template=s)}});